{"version":3,"sources":["BotApi.js","panels/Home.js","panels/com_constructor/ComList.js","panels/com_constructor/ComItemButton.js","panels/com_constructor/ComItem.js","panels/com_constructor/Text.js","panels/com_constructor/Post.js","panels/com_constructor/Media.js","panels/com_constructor/ComPanel.js","panels/com_constructor/ComConstructor.js","panels/com_constructor/ComEditor.js","App.js","index.js"],"names":["BotApi","method","url","body","tempMethod","xhr","XMLHttpRequest","open","encodeURIComponent","document","location","href","setRequestHeader","send","JSON","stringify","responseText","length","parse","id","this","query","userId","addr","response","Home","props","state","dbinfo","getUser","user","before","src","photo_200","description","Nick","first_name","last_name","size","level","onClick","go","data-to","React","Component","osName","platform","ComList","openCommand","bind","e","i","currentTarget","dataset","comindex","app","setState","ps","activePanel","command","comArr","map","a","data-comindex","name","getUserCommands","left","IOS","header","hidden","getList","ComItemButton","setItem","cc","item","status","mode","rusName","ComItem","selectItemType","setFieldHidden","changeField","deleteItem","changeTextField","v","target","value","type","types","t","n","isNaN","aside","fields","Text","placeholder","text","onChange","Post","changeCheckBox","checked","withPinned","reference","owner","number","Media","getIdsMap","addId","deleteId","changeId","checkIdsCount","ids","albumIds","field","push","index","splice","count","idsItems","forEach","str","asideContent","data-index","data-field","disabled","ComPanel","comName","priority","needPermission","communities","post","image","video","changeName","validateEmpty","getAlert","validateStatus","validate","deleteCommand","selectCommunity","getCommunities","addCommunity","deleteCommunity","communsList","getAvailableCommunities","includes","toLowerCase","arr","validatePostEmpty","validateMediaEmpty","aa","trim","actions","title","autoclose","onClose","setPopout","error","prepareCommandBody","match","Error","replace","split","resp","vk","undefined","resp2","testOwner","refs","prepareInt","Number","prepareArray","join","isExist","preparePostData","prepareMediaData","err","message","communityLinks","c","tribe","author","objId","ownerId","postId","console","log","action","to","comm","top","actionText","style","color","ComConstructor","addCommand","createCommand","ComEditor","com","cl","parseMediaItem","updateCommand","App","obj","bridge","fetchedUser","popout","getParam","fetchData","key","p","window","search","RegExp","panel","subscribe","detail","data","schemeAttribute","createAttribute","scheme","attributes","setNamedItem","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.7072ac70.chunk.js","sourcesContent":["class BotApi {\r\n    static query(method, url, body) {\r\n        const tempMethod = method === 'GET' ? method : 'POST'\r\n        var xhr = new XMLHttpRequest()\r\n        xhr.open(tempMethod, `https://pavlentygood.fvds.ru/query.php?method=${method}&url=${encodeURIComponent('http://91.240.84.91:8124/roybot/' + url)}&auth_url=${encodeURIComponent(document.location.href)}`, false)\r\n        if (method === 'POST' || method === 'PUT') {\r\n            xhr.setRequestHeader('Content-Type', 'application/json')\r\n            xhr.send(JSON.stringify(body))\r\n        } else {\r\n            xhr.send()\r\n        }\r\n        if (xhr.responseText === 'auth_error') {\r\n            return xhr.responseText\r\n        }\r\n        if (xhr.responseText.length > 0) {\r\n            return xhr.responseText === 'error' ? 'error' : JSON.parse(xhr.responseText)\r\n        }\r\n    }\r\n\r\n    static getUser(id) {\r\n        return this.query('GET', `app_info?userId=${id}`)\r\n    }\r\n\r\n    static getAvailableCommunities(userId) {\r\n        return this.query('GET', `available_communities?userId=${userId}`)\r\n    }\r\n\r\n    static getUserCommands(userId) {\r\n        return this.query('GET', `simple_command?userId=${userId}`)\r\n    }\r\n\r\n    static addCommand(body) {\r\n        return this.query('POST', 'simple_command', body)\r\n    }\r\n\r\n    static updateCommand(body) {\r\n        return this.query('PUT', 'simple_command', body)\r\n    }\r\n\r\n    static deleteCommand(id) {\r\n        return this.query('DELETE', `simple_command?id=${id}`)\r\n    }\r\n\r\n    static vk(url) {\r\n        var addr = `https://api.vk.com/method/${url}&v=5.81&access_token=81025aad81025aad81025aad7c8173fe038810281025aaddfadd240e8df843a9e48e0fe`\r\n        var xhr = new XMLHttpRequest()\r\n        xhr.open('GET', `https://pavlentygood.fvds.ru/query.php?method=GET&url=${encodeURIComponent(addr)}&auth_url=${encodeURIComponent(document.location.href)}`, false)\r\n        xhr.send()\r\n        if (xhr.responseText === 'auth_error') {\r\n            return xhr.responseText\r\n        }\r\n        if (xhr.responseText.length > 0) {\r\n            return xhr.responseText === 'error' ? 'error' : JSON.parse(xhr.responseText).response\r\n        }\r\n    }\r\n}\r\n\r\nexport default BotApi\r\n","import React from 'react'\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel'\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader'\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\nimport Group from '@vkontakte/vkui/dist/components/Group/Group'\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell'\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar'\nimport BotApi from '../BotApi'\n\nclass Home extends React.Component {\n\tconstructor(props) {\n\t\tsuper()\n\t\tthis.state = {\n\t\t\tdbinfo: BotApi.getUser(props.userId)\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<Panel id={this.props.id}>\n\t\t\t\t{this.props.user &&\n\t\t\t\t\t<Group>\n\t\t\t\t\t\t<PanelHeader>RoyBot</PanelHeader>\n\t\t\t\t\t\t<Cell\n\t\t\t\t\t\t\tbefore={<Avatar src={this.props.user.photo_200} />}\n\t\t\t\t\t\t\tdescription={this.state.dbinfo.Nick ?? 'Нет ника'}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{`${this.props.user.first_name} ${this.props.user.last_name}`}\n\t\t\t\t\t\t</Cell>\n\t\t\t\t\t\t<Div>\n\t\t\t\t\t\t\t<Button size=\"l\" level=\"2\" onClick={this.props.go} data-to=\"com_list\">Конструктор команд</Button>\n\t\t\t\t\t\t</Div>\n\t\t\t\t\t</Group>}\n\t\t\t</Panel>\n\t\t)\n\t}\n}\n\nexport default Home\n","import React from 'react'\r\nimport { platform, IOS } from '@vkontakte/vkui'\r\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel'\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader'\r\nimport PanelHeaderButton from '@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton'\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back'\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back'\r\nimport Icon16BrowserForvard from '@vkontakte/icons/dist/24/browser_forward'\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\r\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group'\r\nimport List from '@vkontakte/vkui/dist/components/List/List'\r\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell'\r\nimport Header from '@vkontakte/vkui/dist/components/Header/Header'\r\nimport BotApi from '../../BotApi'\r\n\r\nconst osName = platform()\r\n\r\nclass ComList extends React.Component {\r\n    constructor() {\r\n        super()\r\n        this.openCommand = this.openCommand.bind(this)\r\n    }\r\n\r\n    openCommand(e) {\r\n        const i = e.currentTarget.dataset.comindex\r\n        this.props.app.setState(ps => {\r\n            ps.activePanel = 'com_editor'\r\n            this.props.app.command = this.props.app.comArr[i]\r\n            return ps\r\n        })\r\n    }\r\n\r\n    getList() {\r\n        return (\r\n            <List>\r\n                {this.props.app.comArr.map((a, i) => (\r\n                    <Cell\r\n                        before={<Icon16BrowserForvard />}\r\n                        onClick={this.openCommand}\r\n                        data-comindex={i}\r\n                    >{a.name}</Cell>\r\n                ))}\r\n            </List>\r\n        )\r\n    }\r\n\r\n    render() {\r\n        this.props.app.comArr = BotApi.getUserCommands(this.props.userId)\r\n        return (\r\n            <Panel id={this.props.id}>\r\n                <PanelHeader\r\n                    left={<PanelHeaderButton onClick={this.props.go} data-to=\"home\">\r\n                        {osName === IOS ? <Icon28ChevronBack /> : <Icon24Back />}\r\n                    </PanelHeaderButton>}\r\n                >Конструктор команд</PanelHeader>\r\n                <Group>\r\n                    <Div>\r\n                        <Button size=\"l\" onClick={this.props.go} data-to=\"com_constructor\">Создать команду</Button>\r\n                    </Div>\r\n                </Group>\r\n                <Group header={<Header>Список созданных команд</Header>}>\r\n                    <Div>\r\n                        {<h4 hidden={this.props.app.comArr.length > 0}>Пусто</h4>}\r\n                        {this.getList()}\r\n                    </Div>\r\n                </Group>\r\n            </Panel>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ComList\r\n","import React from 'react'\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\r\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\r\n\r\nclass ComItemButton extends React.Component {\r\n    constructor() {\r\n        super()\r\n        this.setItem = this.setItem.bind(this)\r\n    }\r\n\r\n    setItem() {\r\n        this.props.cc.setState(ps => {\r\n            ps[this.props.item.name].status = !ps[this.props.item.name].status\r\n            return ps\r\n        })\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Div hidden={this.props?.item?.status}>\r\n                <Button\r\n                    size='m'\r\n                    onClick={this.setItem}\r\n                    mode='commerce'\r\n                >\r\n                    {`Добавить ${this.props.item.rusName}`}\r\n                </Button>\r\n            </Div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ComItemButton\r\n","import React from 'react'\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group'\r\nimport Header from '@vkontakte/vkui/dist/components/Header/Header'\r\nimport Icon28Cancel from '@vkontakte/icons/dist/28/cancel_outline'\r\n\r\nclass ComItem extends React.Component {\r\n    constructor(props) {\r\n        super()\r\n        this.state = {\r\n            item: props.item\r\n        }\r\n        this.selectItemType = this.selectItemType.bind(this)\r\n        this.setFieldHidden = this.setFieldHidden.bind(this)\r\n        this.changeField = this.changeField.bind(this)\r\n        this.deleteItem = this.deleteItem.bind(this)\r\n        this.changeTextField = this.changeTextField.bind(this)\r\n    }\r\n\r\n    selectItemType(e) {\r\n        const v = e.target.value\r\n        this.props.cc.setState(ps => {\r\n            this.state.item.type = v.length == 0 ? null : v\r\n            return ps\r\n        })\r\n    }\r\n\r\n    setFieldHidden(types) {\r\n        for (var t in types) {\r\n            if (types[t] === this.state.item.type) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    }\r\n\r\n    changeField(e) {\r\n        const n = e.currentTarget.name\r\n        const v = e.currentTarget.value\r\n        this.props.cc.setState(ps => {\r\n            if (v === '' || v === '-' || n === 'text' || !isNaN(v)) {\r\n                this.state.item[n] = v\r\n            }\r\n            return ps\r\n        })\r\n    }\r\n\r\n    changeTextField(e) {\r\n        const n = e.currentTarget.name\r\n        const v = e.currentTarget.value\r\n        this.props.cc.setState(ps => {\r\n                this.state.item[n] = v\r\n            return ps\r\n        })\r\n    }\r\n\r\n    deleteItem() {\r\n        this.props.cc.setState(ps => {\r\n            this.state.item.status = false\r\n            return ps\r\n        })\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Group\r\n                hidden={!this.state.item.status}\r\n                header={<Header mode=\"secondary\" aside={<Icon28Cancel onClick={this.deleteItem} />}>{this.state.item.rusName}</Header>}>\r\n                {this.fields()}\r\n            </Group>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ComItem\r\n","import React from 'react'\r\nimport { Input } from '@vkontakte/vkui'\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\r\nimport List from '@vkontakte/vkui/dist/components/List/List'\r\nimport TextArea from '@vkontakte/vkui/dist/components/TextArea/TextArea'\r\nimport ComItem from './ComItem'\r\n\r\nclass Text extends ComItem {\r\n    constructor(props) {\r\n        super(props)\r\n    }\r\n\r\n    fields() {\r\n        return (\r\n            <List>\r\n                <Div>\r\n                    <TextArea placeholder=\"Текст команды\" name=\"text\" value={this.state.item.text} onChange={this.changeField} />\r\n                </Div>\r\n            </List>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Text\r\n","import React from 'react'\r\nimport { Input, Select } from '@vkontakte/vkui'\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\r\nimport List from '@vkontakte/vkui/dist/components/List/List'\r\nimport CheckBox from '@vkontakte/vkui/dist/components/CheckBox/CheckBox'\r\nimport ComItem from './ComItem'\r\n\r\nclass Post extends ComItem {\r\n    constructor(props) {\r\n        super(props)\r\n        this.changeCheckBox = this.changeCheckBox.bind(this)\r\n    }\r\n\r\n    changeCheckBox(e) {\r\n        const n = e.target.name\r\n        const v = e.target.checked\r\n        this.props.cc.setState(ps => {\r\n            this.state.item.withPinned = v\r\n            return ps\r\n        })\r\n    }\r\n\r\n    fields() {\r\n        return (\r\n            <List>\r\n                <Div>\r\n                    <Select placeholder=\"Выберите тип\" value={this.state.item.type} onChange={this.selectItemType}>\r\n                        <option value=\"reference\">По ссылке</option>\r\n                        <option value=\"pinned\">Закрепленный</option>\r\n                        <option value=\"number\">По порядковому номеру</option>\r\n                    </Select>\r\n                </Div>\r\n                <Div hidden={this.setFieldHidden(['reference'])}>\r\n                    <Input type=\"text\" placeholder=\"Ссылка на пост\" name=\"reference\" value={this.state.item.reference} onChange={this.changeTextField} />\r\n                </Div>\r\n                <Div hidden={this.setFieldHidden(['number', 'pinned'])}>\r\n                    <Input type=\"text\" placeholder=\"Ссылка на владельца\" name=\"owner\" value={this.state.item.owner} onChange={this.changeTextField} />\r\n                </Div>\r\n                <Div hidden={this.setFieldHidden(['number'])}>\r\n                    <Input type=\"text\" placeholder=\"Порядковый номер\" name=\"number\" value={this.state.item.number} onChange={this.changeField} />\r\n                </Div>\r\n                <Div hidden={this.setFieldHidden(['number'])}>\r\n                    <CheckBox name='withPinned' checked={this.state.item.withPinned} onChange={this.changeCheckBox}>Учитывать закрепленный пост</CheckBox>\r\n                </Div>\r\n            </List>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Post\r\n","import React from 'react'\r\nimport { Input, Select } from '@vkontakte/vkui'\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\r\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\r\nimport List from '@vkontakte/vkui/dist/components/List/List'\r\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell'\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group'\r\nimport Icon24Add from '@vkontakte/icons/dist/24/add'\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel'\r\nimport ComItem from './ComItem'\r\n\r\nclass Media extends ComItem {\r\n    constructor(props) {\r\n        super(props)\r\n        this.getIdsMap = this.getIdsMap.bind(this)\r\n        this.addId = this.addId.bind(this)\r\n        this.deleteId = this.deleteId.bind(this)\r\n        this.changeId = this.changeId.bind(this)\r\n        this.checkIdsCount = this.checkIdsCount.bind(this)\r\n    }\r\n\r\n    selectItemType(e) {\r\n        super.selectItemType(e)\r\n        if (e.target.value === 'reference') {\r\n            this.props.cc.setState(ps => {\r\n                this.state.item.ids = ['']\r\n                return ps\r\n            })\r\n        } else {\r\n            this.props.cc.setState(ps => {\r\n                this.state.item.ids = []\r\n                return ps\r\n            })\r\n        }\r\n\r\n        if (e.target.value != 'id') {\r\n            this.props.cc.setState(ps => {\r\n                this.state.item.albumIds = ['']\r\n                return ps\r\n            })\r\n        } else {\r\n            this.props.cc.setState(ps => {\r\n                this.state.item.albumIds = []\r\n                return ps\r\n            })\r\n        }\r\n    }\r\n\r\n    changeId(e) {\r\n        const n = e.currentTarget.name\r\n        const v = e.currentTarget.value\r\n        const field = e.currentTarget.dataset.field\r\n        this.props.cc.setState(ps => {\r\n            this.state.item[field][n] = v\r\n            return ps\r\n        })\r\n    }\r\n\r\n    addId(e) {\r\n        const field = e.currentTarget.dataset.field\r\n        this.props.cc.setState(ps => {\r\n            this.state.item[field].push('')\r\n            return ps\r\n        })\r\n    }\r\n\r\n    deleteId(e) {\r\n        const field = e.currentTarget.dataset.field\r\n        const index = e.currentTarget.dataset.index\r\n        this.props.cc.setState(ps => {\r\n            this.state.item[field].splice(index, 1)\r\n            return ps\r\n        })\r\n    }\r\n\r\n    checkIdsCount() {\r\n        var count = 0\r\n        this.props.cc.idsItems.forEach(item => count += item.ids.length)\r\n        return count < 10\r\n    }\r\n\r\n    getIdsMap(field, str, types) {\r\n        return (\r\n            <Group hidden={this.setFieldHidden(types)}>\r\n                {this.state.item[field].map((id, i) => (\r\n                    <Cell asideContent={<Icon24Cancel hidden={this.state.item[field].length < 2} data-index={i} data-field={field} onClick={this.deleteId} />}>\r\n                        <Input\r\n                            name={i}\r\n                            value={id}\r\n                            type=\"text\"\r\n                            placeholder={str}\r\n                            value={this.state.item[field][i]}\r\n                            data-field={field}\r\n                            onChange={this.changeId}\r\n                        />\r\n                    </Cell>))}\r\n                <Div>\r\n                    <Button\r\n                        size=\"s\"\r\n                        before={<Icon24Add />}\r\n                        disabled={field == 'ids' ? !this.checkIdsCount() : false}\r\n                        data-field={field}\r\n                        onClick={this.addId}\r\n                    >Добавить</Button>\r\n                </Div>\r\n            </Group>\r\n        )\r\n    }\r\n\r\n    fields() {\r\n        return (\r\n            <List>\r\n                <Div>\r\n                    <Select placeholder=\"Выберите тип\" value={this.state.item.type} onChange={this.selectItemType}>\r\n                        <option value=\"reference\">По ссылке</option>\r\n                        <option value=\"random\">Случайное</option>\r\n                        <option value=\"number\">По номеру</option>\r\n                        <option value=\"all\">Все содержимое альбома</option>\r\n                    </Select>\r\n                </Div>\r\n                <Div hidden={this.setFieldHidden(['number', 'all'])}>\r\n                    <Input type=\"text\" placeholder=\"Ссылка на альбом\" name={0} data-field='albumIds' value={this.state.item.albumIds[0]} onChange={this.changeId} />\r\n                </Div>\r\n                <Div hidden={this.setFieldHidden(['number'])}>\r\n                    <Input type=\"text\" placeholder=\"Номер медиавложения\" name='number' value={this.state.item.number} onChange={this.changeField} />\r\n                </Div>\r\n                {this.getIdsMap('ids', 'Ссылка на медиавложение', ['reference'])}\r\n                {this.getIdsMap('albumIds', 'Ccылка на альбом', ['random'])}\r\n            </List>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Media\r\n","import React from 'react'\r\nimport { platform, IOS, Select } from '@vkontakte/vkui'\r\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel'\r\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader'\r\nimport PanelHeaderButton from '@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton'\r\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back'\r\nimport Icon24Back from '@vkontakte/icons/dist/24/back'\r\nimport { FormLayout, FormLayoutGroup, Input } from '@vkontakte/vkui'\r\nimport Div from '@vkontakte/vkui/dist/components/Div/Div'\r\nimport Button from '@vkontakte/vkui/dist/components/Button/Button'\r\nimport Group from '@vkontakte/vkui/dist/components/Group/Group'\r\nimport Alert from '@vkontakte/vkui/dist/components/Alert/Alert'\r\nimport Header from '@vkontakte/vkui/dist/components/Header/Header'\r\nimport Separator from '@vkontakte/vkui/dist/components/Separator/Separator'\r\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell'\r\nimport Icon24Add from '@vkontakte/icons/dist/24/add'\r\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel'\r\nimport CheckBox from '@vkontakte/vkui/dist/components/CheckBox/CheckBox'\r\nimport ComItemButton from './ComItemButton'\r\nimport Text from './Text'\r\nimport Post from './Post'\r\nimport Media from './Media'\r\nimport BotApi from '../../BotApi'\r\n\r\nconst osName = platform()\r\n\r\nclass ComPanel extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            id: 0,\r\n            comName: '',\r\n            priority: '',\r\n            needPermission: false,\r\n            communities: [],\r\n            text: {\r\n                name: 'text',\r\n                rusName: 'текст',\r\n                status: false,\r\n                text: '',\r\n            },\r\n            post: {\r\n                name: 'post',\r\n                rusName: 'пост',\r\n                status: false,\r\n                type: null,\r\n                withPinned: false,\r\n                owner: '',\r\n                id: '',\r\n                number: '',\r\n                reference: '',\r\n            },\r\n            image: {\r\n                name: 'image',\r\n                rusName: 'изображение',\r\n                status: false,\r\n                type: null,\r\n                owner: '',\r\n                number: '',\r\n                ids: [],\r\n                albumIds: [],\r\n            },\r\n            video: {\r\n                name: 'video',\r\n                rusName: 'видео',\r\n                status: false,\r\n                type: null,\r\n                owner: '',\r\n                number: '',\r\n                ids: [],\r\n                albumIds: [],\r\n            }\r\n        }\r\n\r\n        this.idsItems = [this.state.image, this.state.video]\r\n\r\n        this.changeName = this.changeName.bind(this)\r\n        this.validateEmpty = this.validateEmpty.bind(this)\r\n        this.getAlert = this.getAlert.bind(this)\r\n        this.validateStatus = this.validateStatus.bind(this)\r\n        this.validate = this.validate.bind(this)\r\n        this.deleteCommand = this.deleteCommand.bind(this)\r\n        this.changeField = this.changeField.bind(this)\r\n        this.selectCommunity = this.selectCommunity.bind(this)\r\n        this.getCommunities = this.getCommunities.bind(this)\r\n        this.addCommunity = this.addCommunity.bind(this)\r\n        this.deleteCommunity = this.deleteCommunity.bind(this)\r\n        this.changeCheckBox = this.changeCheckBox.bind(this)\r\n\r\n        this.communsList = BotApi.getAvailableCommunities(props.userId)\r\n    }\r\n\r\n    changeName(e) {\r\n        const v = e.currentTarget.value\r\n        this.setState(ps => {\r\n            if (!v.includes(' ') && !v.includes('\\n')) {\r\n                this.state.comName = v.toLowerCase()\r\n            }\r\n            return ps\r\n        })\r\n    }\r\n\r\n    validateStatus() {\r\n        const arr = [\r\n            this.state.text,\r\n            this.state.post,\r\n            this.state.image,\r\n            this.state.video,\r\n        ]\r\n        for (var a in arr) {\r\n            const aa = arr[a]\r\n            if (aa.status) {\r\n                return true\r\n            }\r\n        }\r\n        return false\r\n    }\r\n\r\n    validatePostEmpty(arr, item) {\r\n        if (item.status) {\r\n            if (item.type != 'reference') {\r\n                arr.push(item.owner)\r\n            }\r\n            switch (item.type) {\r\n                case 'reference':\r\n                    arr.push(item.reference)\r\n                    break\r\n                case 'number': arr.push(item.number)\r\n                    break\r\n            }\r\n        }\r\n    }\r\n\r\n    validateMediaEmpty(arr, item) {\r\n        if (item.status) {\r\n            if (item.type != 'reference') {\r\n                for (var a in item.albumIds) {\r\n                    arr.push(item.albumIds[a])\r\n                }\r\n            }\r\n            switch (item.type) {\r\n                case 'reference':\r\n                    for (var a in item.ids) {\r\n                        arr.push(item.ids[a])\r\n                    }\r\n                    break\r\n                case 'number':\r\n                    arr.push(item.number)\r\n                    break\r\n            }\r\n        }\r\n    }\r\n\r\n    validateEmpty() {\r\n        const arr = []\r\n        if (this.state.text.status) {\r\n            arr.push(this.state.text.text)\r\n        }\r\n        this.validatePostEmpty(arr, this.state.post)\r\n        this.validateMediaEmpty(arr, this.state.image)\r\n        this.validateMediaEmpty(arr, this.state.video)\r\n        for (var a in arr) {\r\n            const aa = arr[a]\r\n            if (aa === null || aa.trim() === '') {\r\n                return false\r\n            }\r\n        }\r\n        for (var a in this.state.communities) {\r\n            const aa = this.state.communities[a]\r\n            if (aa === '') {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    }\r\n\r\n    getAlert(text) {\r\n        return (\r\n            <Alert\r\n                actions={[{\r\n                    title: 'ОК',\r\n                    mode: 'cancel',\r\n                    autoclose: true,\r\n                }]}\r\n                onClose={() => this.props.app.setPopout(null)}\r\n            >\r\n                <p>{text}</p>\r\n            </Alert>\r\n        )\r\n    }\r\n\r\n    validate() {\r\n        const error = text => this.props.app.setPopout(this.getAlert(text))\r\n\r\n        if (this.state.comName == null || this.state.comName.trim() == '') {\r\n            return error('Название команды не может быть пустым!')\r\n        }\r\n        if (!this.validateStatus()) {\r\n            return error('Ответ команды не может быть пустым!')\r\n        }\r\n        if (!this.validateEmpty()) {\r\n            return error('Не все поля заполнены!')\r\n        }\r\n\r\n        this.prepareCommandBody()\r\n    }\r\n\r\n    preparePostData(item) {\r\n        if (item.type === 'reference') {\r\n            var str = item.reference\r\n            var m = str.match(/vk.com\\/wall.\\d+_\\d+$/)\r\n            if (m == null) {\r\n                throw new Error('Поле со ссылкой на пост имеет неверный формат!')\r\n            }\r\n            str = str.replace(/^.*vk.com\\/wall/, '')\r\n            var arr = str.split('_')\r\n            item.owner = arr[0]\r\n            item.id = arr[1]\r\n        }\r\n\r\n        if (item.type === 'pinned' || item.type === 'number') {\r\n            var str = item.owner\r\n            var m = str.match(/vk\\.com\\//)\r\n            if (m == null) {\r\n                throw new Error('Поле со ссылкой на владельца имеет неверный формат!')\r\n            }\r\n            str = str.replace(/^.*vk\\.com\\//, '')\r\n            var resp = BotApi.vk(`groups.getById?group_id=${str}`)\r\n            if (resp == undefined) {\r\n                var resp2 = BotApi.vk(`users.get?user_ids=${str}`)\r\n                if (resp2 == undefined) {\r\n                    throw new Error('Ошибка обработки ссылки на владельца!')\r\n                } else {\r\n                    item.owner = resp2[0].id + ''\r\n                }\r\n            } else {\r\n                item.owner = '-' + resp[0].id\r\n            }\r\n        }\r\n    }\r\n\r\n    prepareMediaData(item) {\r\n        if (item.type === 'reference') {\r\n            var testOwner = null\r\n            var refs = []\r\n            for (var i in item.ids) {\r\n                var str = item.ids[i]\r\n                var m = item.name === 'image' ? str.match(/vk\\.com\\/photo.\\d+_\\d+$/) : str.match(/vk\\.com\\/video.\\d+_\\d+$/)\r\n                if (m == null) {\r\n                    throw new Error('Поле со ссылкой на медиавложение имеет неверный формат!')\r\n                }\r\n                str = item.name === 'image' ? str.replace(/^.*vk\\.com\\/photo/, '') : str.replace(/^.*vk\\.com\\/video/, '')\r\n                var arr = str.split('_')\r\n                if (testOwner != null && testOwner != arr[0]) {\r\n                    throw new Error('Все медиавложения должны принадлежать одному владельцу!')\r\n                }\r\n                testOwner = arr[0]\r\n                refs.push(arr[1])\r\n            }\r\n            item.owner = testOwner\r\n            item.ids = refs\r\n        }\r\n\r\n        if (item.type === 'random' || item.type === 'number' || item.type === 'all') {\r\n            var testOwner = null\r\n            var refs = []\r\n            for (var i in item.albumIds) {\r\n                var str = item.albumIds[i]\r\n                var m = str.match(/vk\\.com\\/album.\\d+_\\d+$/)\r\n                if (m == null) {\r\n                    throw new Error('Поле со ссылкой на альбом имеет неверный формат!')\r\n                }\r\n                str = str.replace(/^.*vk\\.com\\/album/, '')\r\n                var arr = str.split('_')\r\n                if (testOwner != null && testOwner != arr[0]) {\r\n                    throw new Error('Все альбомы должны принадлежать одному владельцу!')\r\n                }\r\n                testOwner = arr[0]\r\n                refs.push(arr[1])\r\n            }\r\n            item.owner = testOwner\r\n            item.albumIds = refs\r\n        }\r\n    }\r\n\r\n    prepareCommandBody() {\r\n        const error = text => this.props.app.setPopout(this.getAlert(text))\r\n        const prepareInt = a => Number(a.trim() == '' ? '0' : a)\r\n        const prepareArray = a => a.map(id => id == null || id === '' ? '' : id).join(' ')\r\n        const isExist = a => a.status && a.type != null && a.type.length > 0\r\n\r\n        try {\r\n            this.preparePostData(this.state.post)\r\n            this.prepareMediaData(this.state.image)\r\n            this.prepareMediaData(this.state.video)\r\n        } catch (err) {\r\n            error(err.message)\r\n            return\r\n        }\r\n\r\n        var body = {\r\n            id: this.state.id == 0 ? undefined : this.state.id,\r\n            name: this.state.comName,\r\n            text: this.state.text.status ? this.state.text.text : null,\r\n            priority: prepareInt(this.state.priority),\r\n            needPermission: this.state.needPermission,\r\n            communityLinks: this.state.communities.map(c => {\r\n                return { tribe: { id: c } }\r\n            }),\r\n            author: {\r\n                id: prepareInt(this.props.userId),\r\n            },\r\n            post: isExist(this.state.post) ? {\r\n                id: this.state.post.objId,\r\n                type: this.state.post.type,\r\n                ownerId: prepareInt(this.state.post.owner),\r\n                postId: prepareInt(this.state.post.id),\r\n                number: prepareInt(this.state.post.number),\r\n                withPinned: this.state.post.withPinned,\r\n            } : null,\r\n            image: isExist(this.state.image) ? {\r\n                id: this.state.image.objId,\r\n                type: this.state.image.type,\r\n                ownerId: prepareInt(this.state.image.owner),\r\n                number: prepareInt(this.state.image.number),\r\n                ids: prepareArray(this.state.image.ids),\r\n                albumIds: prepareArray(this.state.image.albumIds),\r\n            } : null,\r\n            video: isExist(this.state.video) ? {\r\n                id: this.state.video.objId,\r\n                type: this.state.video.type,\r\n                ownerId: prepareInt(this.state.video.owner),\r\n                number: prepareInt(this.state.video.number),\r\n                ids: prepareArray(this.state.video.ids),\r\n                albumIds: prepareArray(this.state.video.albumIds),\r\n            } : null\r\n        }\r\n\r\n        console.log('send body: ' + JSON.stringify(body))\r\n\r\n        this.action(body)\r\n    }\r\n\r\n    deleteCommand() {\r\n        var resp = BotApi.deleteCommand(this.state.id)\r\n\r\n        this.props.app.go({ currentTarget: { dataset: { to: 'com_list' } } })\r\n        this.props.app.setPopout(\r\n            <Alert\r\n                actions={[{\r\n                    title: 'ОК',\r\n                    mode: 'cancel',\r\n                    autoclose: true,\r\n                }]}\r\n                onClose={() => this.props.app.setPopout(null)}\r\n            >\r\n                <p>{resp === 'error' ? 'Ошибка удаления команды!' : 'Команда удалена!'}</p>\r\n            </Alert>\r\n        )\r\n    }\r\n\r\n    changeField(e) {\r\n        const n = e.currentTarget.name\r\n        const v = e.currentTarget.value\r\n        this.setState(ps => {\r\n            if (v === '' || n === 'text' || !isNaN(v) || v === '-') {\r\n                this.state[n] = v\r\n            }\r\n            return ps\r\n        })\r\n    }\r\n\r\n    selectCommunity(e) {\r\n        const n = e.currentTarget.name\r\n        const v = e.currentTarget.value\r\n        this.setState(ps => {\r\n            ps.communities[n] = v === '' ? '' : Number(v)\r\n            return ps\r\n        })\r\n    }\r\n\r\n    addCommunity() {\r\n        this.setState(ps => {\r\n            ps.communities.push('')\r\n            return ps\r\n        })\r\n    }\r\n\r\n    deleteCommunity(e) {\r\n        const index = e.currentTarget.dataset.index\r\n        this.setState(ps => {\r\n            ps.communities.splice(index, 1)\r\n            return ps\r\n        })\r\n    }\r\n\r\n    getCommunities() {\r\n        return (\r\n            <Group header={<Header>Подключение трайбов</Header>}>\r\n                <FormLayout>\r\n                    {this.state.communities.map((c, i) => (\r\n                        <Cell asideContent={<Icon24Cancel data-index={i} onClick={this.deleteCommunity} />}>\r\n                            <Select placeholder=\"Выберите трайб\" name={i} value={c} onChange={this.selectCommunity}>\r\n                                {this.communsList.map(comm => <option value={comm.id}>{comm.name}</option>)}\r\n                            </Select>\r\n                        </Cell>\r\n                    ))}\r\n                    <Button size=\"s\" before={<Icon24Add />} disabled={this.state.communities.length >= 10} onClick={this.addCommunity}>Добавить трайб</Button>\r\n                </FormLayout>\r\n            </Group>\r\n        )\r\n    }\r\n\r\n    changeCheckBox(e) {\r\n        const n = e.target.name\r\n        const v = e.target.checked\r\n        this.setState(ps => {\r\n            ps.needPermission = v\r\n            return ps\r\n        })\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Panel id={this.props.id}>\r\n                <PanelHeader\r\n                    left={<PanelHeaderButton onClick={this.props.go} data-to=\"com_list\">\r\n                        {osName === IOS ? <Icon28ChevronBack /> : <Icon24Back />}\r\n                    </PanelHeaderButton>}\r\n                >{this.header}</PanelHeader>\r\n                <FormLayout>\r\n                    <Group>\r\n                        <Div><Input type=\"text\" placeholder=\"Название команды\" value={this.state.comName} onChange={this.changeName} /></Div>\r\n                    </Group>\r\n                    <Separator />\r\n                    <Group header={<Header>Ответ команды</Header>}>\r\n                        <Text cc={this} item={this.state.text} />\r\n                        <Post cc={this} item={this.state.post} />\r\n                        <Media cc={this} item={this.state.image} />\r\n                        <Media cc={this} item={this.state.video} />\r\n                    </Group>\r\n                </FormLayout>\r\n                <Group>\r\n                    <ComItemButton cc={this} item={this.state.text} />\r\n                    <ComItemButton cc={this} item={this.state.post} />\r\n                    <ComItemButton cc={this} item={this.state.image} />\r\n                    <ComItemButton cc={this} item={this.state.video} />\r\n                </Group>\r\n                <Separator />\r\n                <Div>\r\n                    {this.getCommunities()}\r\n                    <Group header={<Header>Дополнительные настройки</Header>}>\r\n                        <FormLayout>\r\n                            <Input top=\"Приоритет\" type=\"text\" name='priority' value={this.state.priority} onChange={this.changeField} />\r\n                            <CheckBox name='needPermission' checked={this.state.needPermission} onChange={this.changeCheckBox}>Необходимо наличие прав</CheckBox>\r\n                        </FormLayout>\r\n                    </Group>\r\n                </Div>\r\n                <Separator />\r\n                <Div>\r\n                    <Group>\r\n                        <Div>\r\n                            <Button size=\"xl\" onClick={this.validate}>{this.actionText}</Button>\r\n                        </Div>\r\n                    </Group>\r\n                    <Group>\r\n                        <Div hidden={this.state.id == 0}>\r\n                            <Button style={{ color: 'red' }} size=\"l\" mode='tertiary' onClick={this.deleteCommand}>Удалить команду</Button>\r\n                        </Div>\r\n                    </Group>\r\n                </Div>\r\n            </Panel>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ComPanel\r\n","import React from 'react'\r\nimport { platform, IOS } from '@vkontakte/vkui'\r\nimport Alert from '@vkontakte/vkui/dist/components/Alert/Alert'\r\nimport BotApi from '../../BotApi'\r\nimport ComPanel from './ComPanel'\r\n\r\nconst osName = platform()\r\n\r\nclass ComConstructor extends ComPanel {\r\n    constructor(props) {\r\n        super(props)\r\n        this.header = 'Создание команды'\r\n        this.actionText = 'Создать команду'\r\n    }\r\n\r\n    createCommand(body) {\r\n        var resp = BotApi.addCommand(body)\r\n\r\n        this.props.app.go({currentTarget: { dataset: { to: 'com_list'}}})\r\n        this.props.app.setPopout(\r\n            <Alert\r\n                actions={[{\r\n                    title: 'ОК',\r\n                    mode: 'cancel',\r\n                    autoclose: true,\r\n                }]}\r\n                onClose={() => this.props.app.setPopout(null)}\r\n            >\r\n                <p>{resp === 'error' ? 'Ошибка создания команды!' : 'Команда создана!'}</p>\r\n            </Alert>\r\n        )\r\n    }\r\n\r\n    action(body) {\r\n        this.createCommand(body)\r\n    }\r\n}\r\n\r\nexport default ComConstructor\r\n","import React from 'react'\r\nimport { platform, IOS } from '@vkontakte/vkui'\r\nimport Alert from '@vkontakte/vkui/dist/components/Alert/Alert'\r\nimport BotApi from '../../BotApi'\r\nimport ComPanel from './ComPanel'\r\n\r\nclass ComEditor extends ComPanel {\r\n    constructor(props) {\r\n        super(props)\r\n        this.header = 'Просмотр команды'\r\n        this.actionText = 'Сохранить'\r\n\r\n        const prepareInt = a => a == 0 ? '' : a + ''\r\n\r\n        const com = props.app.command\r\n\r\n        console.log('receive com: ' + JSON.stringify(com))\r\n\r\n        this.state.id = com.id\r\n        this.state.comName = com.name\r\n        this.state.priority = prepareInt(com.priority)\r\n        this.state.needPermission = com.needPermission\r\n        com.communityLinks.forEach(cl => this.state.communities.push(cl.tribe.id))\r\n        if (com.text != null && com.text != '') {\r\n            this.state.text.status = true\r\n            this.state.text.text = com.text\r\n        }\r\n        if (com.post != null) {\r\n            this.state.post.status = true\r\n            this.state.post.objId = com.post.id\r\n            this.state.post.type = com.post.type\r\n            this.state.post.owner = 'vk.com/' + (com.post.ownerId > 0 ? `id${com.post.ownerId}` : `club${-com.post.ownerId}`)\r\n            this.state.post.reference = `vk.com/wall${com.post.ownerId}_${com.post.postId}`\r\n            this.state.post.number = prepareInt(com.post.number)\r\n            this.state.post.withPinned = com.post.withPinned\r\n        }\r\n        const parseMediaItem = (item, src, t) => {\r\n            if (src == null) {\r\n                return\r\n            }\r\n            item.status = true\r\n            item.objId = src.id\r\n            item.type = src.type\r\n            item.owner = prepareInt(src.ownerId)\r\n            item.number = prepareInt(src.number)\r\n            item.ids = src.ids.split(' ').map(id => `vk.com/${t}${src.ownerId}_${id}`)\r\n            item.albumIds = src.albumIds.split(' ').map(id => `vk.com/album${src.ownerId}_${id}`)\r\n        }\r\n        parseMediaItem(this.state.image, com.image, 'photo')\r\n        parseMediaItem(this.state.video, com.video, 'video')\r\n    }\r\n\r\n    updateCommand(body) {\r\n        var resp = BotApi.updateCommand(body)\r\n\r\n        this.props.app.go({currentTarget: { dataset: { to: 'com_list'}}})\r\n        this.props.app.setPopout(\r\n            <Alert\r\n                actions={[{\r\n                    title: 'ОК',\r\n                    mode: 'cancel',\r\n                    autoclose: true,\r\n                }]}\r\n                onClose={() => this.props.app.setPopout(null)}\r\n            >\r\n                <p>{resp === 'error' ? 'Ошибка сохранения изменений!' : 'Изменения сохранены!'}</p>\r\n            </Alert>\r\n        )\r\n    }\r\n\r\n    action(body) {\r\n        this.updateCommand(body)\r\n    }\r\n}\r\n\r\nexport default ComEditor\r\n","import React from 'react'\nimport bridge from '@vkontakte/vk-bridge'\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel'\nimport View from '@vkontakte/vkui/dist/components/View/View'\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner'\nimport '@vkontakte/vkui/dist/vkui.css'\nimport Home from './panels/Home'\nimport ComList from './panels/com_constructor/ComList'\nimport ComConstructor from './panels/com_constructor/ComConstructor'\nimport ComEditor from './panels/com_constructor/ComEditor'\nimport BotApi from './BotApi'\n\nclass App extends React.Component {\n\tconstructor() {\n\t\tsuper()\n\t\tthis.state = {\n\t\t\tfetchedUser: null,\n\t\t\tactivePanel: 'home',\n\t\t\tpopout: <ScreenSpinner size='large' />\n\t\t}\n\t\tthis.getParam = this.getParam.bind(this)\n\t\tthis.go = this.go.bind(this)\n\t\tthis.setPopout = this.setPopout.bind(this)\n\n\t\tasync function fetchData(obj) {\n\t\t\tconst user = await bridge.send('VKWebAppGetUserInfo')\n\t\t\tobj.setState(ps => {\n\t\t\t\tps.fetchedUser = user\n\t\t\t\tps.popout = null\n\t\t\t\treturn ps\n\t\t\t})\n\t\t}\n\n\t\tfetchData(this)\n\t}\n\n\tgetParam(key) {\n\t\tvar p = window.location.search\n\t\tp = p.match(new RegExp(key + '=([^&=]+)'))\n\t\treturn p ? p[1] : false\n\t}\n\n\tgo(e) {\n\t\tconst panel = e.currentTarget.dataset.to\n\t\tthis.setState(ps => {\n\t\t\tps.activePanel = panel\n\t\t\treturn ps\n\t\t})\n\t}\n\n\tsetPopout(popout) {\n\t\tthis.setState(ps => {\n\t\t\tps.popout = popout\n\t\t\treturn ps\n\t\t})\n\t}\n\n\trender() {\n\t\tconst userId = this.getParam('user_id')\n\t\treturn (\n\t\t\t<View activePanel={this.state.activePanel} popout={this.state.popout}>\n\t\t\t\t<Home id='home' user={this.state.fetchedUser} go={this.go} userId={userId} app={this} />\n\t\t\t\t<ComList id='com_list' go={this.go} userId={userId} app={this} />\n\t\t\t\t<ComConstructor id='com_constructor' go={this.go} userId={userId} app={this} />\n\t\t\t\t<ComEditor id='com_editor' go={this.go} userId={userId} app={this} />\n\t\t\t\t<Panel id='auth_error'>\n\t\t\t\t\t<h3>Ошибка авторизации!</h3>\n\t\t\t\t</Panel>\n\t\t\t</View>\n\t\t)\n\t}\n}\n\nexport default App\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nbridge.subscribe(({ detail: { type, data } }) => {\n  if (type === 'VKWebAppUpdateConfig') {\n    const schemeAttribute = document.createAttribute('scheme')\n    schemeAttribute.value = data.scheme ? data.scheme : 'client_light'\n    document.body.attributes.setNamedItem(schemeAttribute)\n  }\n});\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => { }); //runtime download\n}\n"],"sourceRoot":""}